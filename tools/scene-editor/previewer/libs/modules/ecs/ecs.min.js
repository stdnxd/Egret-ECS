var ecs;!function(e){function t(t,n){e.global_ref.listeners[t]=n}function n(t){delete e.global_ref.listener[t]}function i(t,n,i,r,o){void 0===r&&(r=0),void 0===o&&(o=!0),console.log("invoke by scrollScenes",n),e.global_ref.scrollings={designHeight:t,scenes:n,topContainer:i};var a=i.stage.stageHeight,s=-(t-a)/2;n.forEach(function(n,r){var o={};e.global_ref[n.name]={reference:o};var a=u(n.scene,e.global_ref[n.name].reference,null,n.name);e.global_ref[n.name].topIds=a,a.forEach(function(e){o[e].visualable&&!o[e]._prefab&&(o[e]._raw.y=o[e]._raw.y+s+t*r,i.addChild(o[e]._raw))})}),h(r)}function r(t){return e.global_ref.scrollings&&e.global_ref.scrollings.scenes&&t<e.global_ref.scrollings.scenes.length?e.global_ref.scrollings.scenes[t].name:null}function o(t){if(e.global_ref.scrollings&&e.global_ref.scrollings.scenes)for(var n=0;n<e.global_ref.scrollings.scenes.length;n++)if(e.global_ref.scrollings.scenes[n].name===t)return n;return-1}function a(t,n,i){if(i){var r={};e.global_ref[n]={reference:r};var o=u(RES.getRes(i),e.global_ref[n].reference,null,n);e.global_ref[n].topIds=o}var a=e.global_ref[t].reference[1],s=a._raw;if(s.parent){var l=e.global_ref[n].reference,h=s.x,c=s.y,o=e.global_ref[n].topIds;o.forEach(function(e){l[e].visualable&&!l[e]._prefab&&(l[e]._raw.y=c,l[e]._raw.x=h,s.parent.addChild(l[e]._raw))}),o.forEach(function(e){k(l[e])})}}function s(t,n){void 0===R.stageHeight&&(R.stageHeight=e.global_ref.scrollings.topContainer.stage.stageHeight),void 0===R.designHeight&&(R.designHeight=e.global_ref.scrollings.designHeight);var i=Math.floor(-t/R.designHeight),o=-R.designHeight*i,a=o-R.stageHeight;if(o>t&&t>=a){var s=100*(t-o)/(a-o);console.log("scene"+(i+1)+"leaving progress:"+s);var l=r(i);l&&e.global_ref.listeners[l]&&e.global_ref.listeners[l](s,!1)}var h=-R.designHeight*(i+1),c=h+R.stageHeight;if(c>t&&t>=h){var s=100*(t-c)/(h-c);console.log("scene"+(i+2)+"entering progress:"+s);var l=r(i+1);l&&e.global_ref.listeners[l]&&e.global_ref.listeners[l](s,!0)}}function l(e,t){h(o(e),t)}function h(t,n){function i(){var i=r(t);console.log(i+" start"),e.global_ref[i].topIds.forEach(function(t){return k(e.global_ref[i].reference[t])}),n&&n()}function o(){s(this.y)}var a=e.global_ref.scrollings.topContainer,l=e.global_ref.scrollings.designHeight;egret.Tween.get(a,{onChange:o,onChangeObj:a}).to({y:-t*l},800,egret.Ease.cubicInOut).call(i,a)}function c(t,n,i){i||(i=f()),e.global_ref[i]={reference:{},topIds:null};var r=u(t,e.global_ref[i].reference,n,i);return e.global_ref[i].topIds=r,e.global_ref[i]}function f(){for(var t=0;"scene"+t in e.global_ref;)t++;return"scene"+t}function u(e,t,n,i){var r=[];return e.forEach(function(e){return r.push(e.id)}),e.forEach(function(e){return _(e,t,i)}),r.forEach(function(e){return p(t[e],t)}),console.log("references",t),n&&(r.forEach(function(e){t[e].visualable&&!t[e]._prefab&&n.addChild(t[e]._raw)}),r.forEach(function(e){k(t[e])})),r}function _(e,t,n){var i=new P(e);t[e.id]=i,i.visualable=!1,e.parent&&(i.parent=t[e.parent]),e.components.forEach(function(e){return g(e,t,n)}),e.children.forEach(function(e){return _(e,t,n)}),i.parent&&i.parent.children.push(i)}function g(e,t,n){var i=new B(e);n&&(i.sceneName=n),t[e.id]=i;var r=t[e.node];r&&r.addComponent(i)}function d(){return!1}function p(e,t){e.components.forEach(function(n){if(n._wrap_obj.name in D)switch(n._wrap_obj.name){case"Label":n.single=!0,b(n),n.node.visualable=!0,j(n._wrap_obj.properties,n),console.log("set text color:",n.node.color),j({color:n.node.color},n.node),e._raw.addChild(n._raw);break;case"Sprite":n.single=!0,v(n),n.node.visualable=!0,e._raw.addChild(n._raw);break;case"Animation":m(n),n.node.visualable=!0}else"Canvas"===n.name?y(n):E(n,t)}),e.children.forEach(function(e){return p(e,t)})}function w(t){var n=null;e.MODE===e.MODE_PREVIEW?n=new egret.Sprite:e.MODE===e.MODE_RUNTIME&&(n=new egret.DisplayObjectContainer),t._raw=n,M(t)}function b(e){var t=new egret.TextField;e._raw=t,e.node._relative=t,e.aligns={LEFT_TOP:[0,0],RIGHT_BOTTOM:[1,1],RIGHT_TOP:[1,0],LEFT_BOTTOM:[0,1],CENTER:[.5,.5],TOP:[.5,0],LEFT:[0,.5],BOTTOM:[.5,1],RIGHT:[1,.5]},e.resize=function(){console.log(this.node.width,this.node.height,this._raw.textWidth,this._raw.textHeight),this._raw.width=this.node.width,this._raw.height=this.node.height,this._raw.width=this._raw.textWidth,this._raw.height=this._raw.textHeight,this.node.anchorX=this.node.anchorX,this.node.anchorY=this.node.anchorY,this.node.x=this.node.x,this.node.y=this.node.y,this.textAlign=this.textAlign},Object.defineProperties(e,{stroke:{get:function(){return this._raw.stroke},set:function(e){this._raw.stroke=e}},strokeColor:{get:function(){return this._raw.strokeColor},set:function(e){this._raw.strokeColor=e}},text:{get:function(){return this._raw.text},set:function(e){this._raw.text=e,this.resize()}},size:{get:function(){return this._raw.size},set:function(e){this._raw.size=e,this.resize()}},textAlign:{get:function(){return this._align},set:function(e){this._align=e,this._raw.anchorOffsetX=this._raw.textWidth*this.aligns[e][0],this._raw.anchorOffsetY=this._raw.textHeight*this.aligns[e][1],this.node._raw&&(this._raw.x=this.node._raw.anchorOffsetX,this._raw.y=this.node._raw.anchorOffsetY)}}}),Object.defineProperties(e.node,{color:{get:function(){return this._relative.textColor},set:function(e){this._relative.textColor=e}}})}function v(e){var t=new egret.Bitmap;e._raw=t,e.node._relative=t,Object.defineProperties(e,{texture:{get:function(){return this._texture},set:function(e){this._texture=e,this._raw.texture=RES.getRes(this._texture)}}}),t.texture=RES.getRes(e._wrap_obj.properties.texture)}function m(e){var t=e.node,n=egret.Tween.get(t);e._raw=n,e.onPlayEnd=function(e,t){if(console.log(e,t),console.log(this._callBack,this._callBack_end_flag),this._callBack&&this._callBack_end_flag===t){var n=this._callBack;delete this._callBack,n()}},e.playReverse=function(e,t){for(var n=this,i=null,r=0;r<this._wrap_obj.properties.clips.length&&(i=this._wrap_obj.properties.clips[r],i.name!==e);r++)i=null;if(i)for(var r=i.keyframes.length-1;r>=0;r--){var o=i.keyframes[r];n._raw.to(o,i.durations[r]).call(n.onPlayEnd,null,[i.name,r])}},e.play=function(e,t){for(var n=this,i=egret.Tween.get(this.node),r=null,o=0;o<this._wrap_obj.properties.clips.length&&(r=this._wrap_obj.properties.clips[o],r.name!==e);o++)r=null;r&&(t&&(this._callBack=t,this._callBack_end_flag=r.keyframes.length-1),console.log("keyframes",r.keyframes),r.keyframes.forEach(function(e,t){i.to(e,r.durations[t-1]).call(n.onPlayEnd,n,[r.name,t])}))}}function y(e){}function E(t,n){if(console.log("assembleScript",t.name,t.node.name),t.name){var i=n[t.name],r=n[i];void 0===r&&(console.log("protoCompObj undefined"),i=e.global_ref[t.name],r=e.global_ref[i]);var o=r.properties;console.log("declarationObj",o),o&&T(o,t._wrap_obj.properties,t,n);for(var a in r)"properties"!==a&&(t[a]=r[a]);t.onLoad()}}function O(e,t){var n=["width","height","anchorX","anchorY","x","y","scaleX","scaleY","rotation","alpha","color"];n.forEach(function(n){n in e&&(t[n]=e[n])}),x(t)}function x(t){if(e.MODE===e.MODE_PREVIEW){var n=t._raw.graphics;n.clear(),t.isSelected?n.lineStyle(2,238):n.lineStyle(2,4473924),n.beginFill(0,0),n.drawRect(0,0,t.width,t.height),n.endFill()}}function C(e){e.isSelected=!0,x(e),e.children.forEach(function(e){C(e)})}function S(e){e.isSelected=!1,x(e),e.children.forEach(function(e){S(e)})}function j(e,t){for(var n in e)t[n]=e[n]}function T(e,t,n,i){console.log("injectScriptProperties",n.name,n.node.name);for(var r in e){var o=e[r];if("number"==typeof o||"string"==typeof o||"boolean"==typeof o)n[r]=r in t?t[r]:o;else if(o.type)if("string"==typeof o.type||"function"==typeof o.type)n[r]=r in t?t[r]?i[t[r]]:null:o["default"];else if(o.type instanceof Array)if(0===o.type.length)n[r]=r in t?t[r]:o["default"];else{var a=o.type[0];switch(a){case"string":case"number":case"boolean":n[r]=r in t?t[r]:o["default"];break;default:r in t?(n[r]=[],t[r].forEach(function(e){n[r].push(i[e])})):n[r]=o["default"]}}else("set"in o||"get"in o)&&Object.defineProperty(n,r,o)}}function k(e){e.components.forEach(function(e){return e.start()}),e.children.forEach(function(e){return k(e)})}function M(e){Object.defineProperties(e,{width:{get:function(){return this._width},set:function(e){this._width=e,this._relative&&(this._relative.width=e),this._raw.width=e,x(this)}},height:{get:function(){return this._height},set:function(e){this._height=e,this._relative&&(this._relative.height=e),this._raw.height=e,x(this)}},anchorX:{get:function(){return 0!==this.width?this._raw.anchorOffsetX/this.width:this._anchorX},set:function(e){this._anchorX=e,this._raw.anchorOffsetX=e*this.width}},anchorY:{get:function(){return 0!==this.height?this._raw.anchorOffsetY/this.height:this._anchorY},set:function(e){this._anchorY=e,this._raw.anchorOffsetY=e*this.height}},x:{get:function(){return this._x},set:function(e){this._x=e,this.parent&&this.parent._raw?this._raw.x=this.parent._raw.anchorOffsetX+e:this._raw.x=e}},y:{get:function(){return this._y},set:function(e){this._y=e,this.parent&&this.parent._raw?this._raw.y=this.parent._raw.anchorOffsetY+e:this._raw.y=e}},position:{get:function(){return{x:this.x,y:this.y}},set:function(e){this.x=e.x,this.y=e.y}},scaleX:{get:function(){return this._raw.scaleX},set:function(e){this._raw.scaleX=e}},scaleY:{get:function(){return this._raw.scaleY},set:function(e){this._raw.scaleY=e}},rotation:{get:function(){return this._raw.rotation},set:function(e){this._raw.rotation=e}},alpha:{get:function(){return this._raw.alpha},set:function(e){this._raw.alpha=e}}})}function H(t,n,i){e.global_ref[t]=i,e.global_ref[n]=t}function I(e){var t={},n=JSON.parse(JSON.stringify([e._wrap_obj])),i=n[0].id;return n.parent=null,u(n,t),t[i]}e.MODE_RUNTIME="runtime",e.MODE_PREVIEW="preview",e.MODE=e.MODE_RUNTIME,e.global_ref={listeners:{}};var R={},P=function(){function t(e){this._visualable=!1,this._prefab=!1,e&&(this._wrap_obj=e,this.type=e.type,this.name=e.name,this._prefab=e.prefab?!0:!1),this.id=0,this.parent=null,this.children=[],this.components=[]}var n=__define,i=t,r=i.prototype;return n(r,"visualable",function(){return this._visualable},function(t){(e.MODE===e.MODE_PREVIEW||t!==this._visualable)&&(this._visualable=t,e.MODE===e.MODE_PREVIEW||t?(this._raw||w(this),this.parent&&(this.parent.visualable=!0),O(this._wrap_obj.properties,this),this.parent&&this.parent._raw&&this.parent._raw.addChild(this._raw)):this.active=!1)}),r.getChildren=function(){},r.getChildByName=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].name===e)return this.children[t];return null},r.getComponent=function(e){for(var t=0;t<this.components.length;t++)if(this.components[t].name===e)return this.components[t];return null},r.addComponent=function(e){return this._relative&&e.single?!1:(this.components.push(e),e.node=this,!0)},r.setPosition=function(e,t){this._wrap_obj&&this._wrap_obj.properties&&(this._wrap_obj.properties.x=e,this._wrap_obj.properties.y=t)},r.addChild=function(e){e.parent=this,this.children.push(e),e.visualable&&(this.visualable=!0,console.log("node.addChild",this._raw),this._raw&&(this._raw.addChild(e._raw),e.x=e.x,e.y=e.y))},r.removeChild=function(e){},r.removeAllChildren=function(){this.children.length=0,this.visualable&&(this._raw.removeChildren(),this.visualable=!1)},t}();e.Node=P,egret.registerClass(P,"ecs.Node");var B=function(){function e(e){this.single=!1,this._raw=null,e&&(this._wrap_obj=e,this.type=e.type,this.name=e.name),this.id=0,this.node=null}var t=(__define,e),n=t.prototype;return n.getComponent=function(e){return this.node.getComponent(e)},n.onLoad=function(){},n.start=function(){},n.onStop=function(){},e}();e.Component=B,egret.registerClass(B,"ecs.Component"),e.setSceneScrollingListener=t,e.removeSceneScrollingListener=n,e.scrollScenes=i,e.getSceneNameByIndex=r,e.getIndexBySceneName=o,e.switchScene=a,e.scrollToByName=l,e.scrollTo=h,e.parseScene=c,e.saveScene=d;var D={Label:1,Sprite:1,Animation:1};e.selectNode=C,e.cancelSelectNode=S,e.Class=H,e.instantiate=I}(ecs||(ecs={}));