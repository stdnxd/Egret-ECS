<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
    <h1>Egret ECS-Scene-Editor Workspace Select Panel!</h1>
    <p><script>{document.write(process.env);console.log(process.env)}</script></p>
    <ul id="ws_ul">
        <li>新建工作空间名称:
            <input type="text" id="ws_name"/>
            <button onclick="onEdit()">编辑</button>
        </li>
    </ul>
    <h5></h5>
    <script type="text/javascript">
        "use strict"
        const ROUTE = require('electron').remote.getGlobal("ROUTE");
        const ipcRenderer = require('electron').ipcRenderer;
        let config = null;
        ipcRenderer.on(ROUTE.WORKSPACE_INIT,function(event,workspace_config){
            config = workspace_config;
            getWorkspaceFromConfig(workspace_config);
        });

        function getWorkspaceFromConfig(configObj){
            let addHTML = null;
            configObj.projects.forEach(function(project,index){
                addHTML +=
                    '<li>' + project.name +
                        '<button onClick="onOpen('+index+')">打开</button>' +
                        '<button onClick="onEdit('+index+')">编辑</button>' +
                    "</li>";
            });
            let ws_ul = document.getElementById("ws_ul");
            ws_ul.innerHTML = addHTML + ws_ul.innerHTML;
        }

        function onOpen(index){
            console.log("onOpen",index);
            if(config){
                let project = config.projects[index];
                if(project.script_dir && project.script_dir !== "" &&
                    project.res_config && project.res_config !== "" &&
                    project.res_dir && project.res_dir !== "" &&
                    project.open_path && project.open_path !== ""
                ){
                    let SCRIPTOR = require('electron').remote.getGlobal("SCRIPTOR");
                    let ecs = require('electron').remote.getGlobal('ecs');
                    SCRIPTOR.searchDir(project.script_dir);
                    SCRIPTOR.readResConfig(project.res_config);
                    SCRIPTOR.readSceneFile(project.open_path);
                    ecs.res_config = project.res_config;
                    ecs.res_dir = project.res_dir;
                    ipcRenderer.send(ROUTE.SCENE_OPEN,ecs.openPath);
                }else{
                    onEdit(index);
                }
            }
            scriptor.searchDir(path)
        }

        function onEdit(index){
            console.log("onEdit",index);
            if(config) {
                if(index !== undefined){
                    let project = config.projects[index];
                    ipcRenderer.send(ROUTE.WORKSPACE_EDIT,project);
                }else{
                    ipcRenderer.send(ROUTE.WORKSPACE_EDIT);
                }
            }
        }
    </script>
</body>
</html>